<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
 * SESSION_INFO
 * ID							ID						BIGINT						PRIMARY KEY					AUTO_INCREMENT
 * 用户ID						USER_ID					BIGINT						PRIMARY KEY
 * 创建时间						CREATE_TIME				TIMESTAMP					DEFAULT NOW()
 -->
<mapper namespace="com.hanslv.web.chat.mapper.SessionInfoMapper">
    <!-- 获取全部 -->
    <select id="selectAll" resultType="com.hanslv.web.chat.entity.SessionInfoEntity">
        SELECT * FROM SESSION_INFO;
    </select>

    <!-- 根据双方用户ID查询会话 -->
    <select id="selectByUserId" resultType="com.hanslv.web.chat.entity.SessionInfoEntity">
        SELECT
            a.ID AS id,
            a.USER_ID AS userId,
            a.CREATE_TIME AS createTime
        FROM SESSION_INFO a INNER JOIN SESSION_INFO b ON a.ID = b.ID
        WHERE a.USER_ID = #{userId} AND b.USER_ID = #{otherUserId};
    </select>


    <!-- 插入一条数据并返回ID -->
    <insert id="insertOne" parameterType="int">
        INSERT INTO SESSION_INFO (USER_ID) VALUES (#{userId});
        <selectKey resultType="int" order="AFTER" keyProperty="id">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!-- 插入一条包含ID的记录 -->
    <insert id="insertOneWithId">
        INSERT INTO SESSION_INFO (ID, USER_ID) VALUES (#{id}, #{userId});
    </insert>
</mapper>